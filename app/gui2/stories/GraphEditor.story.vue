<script setup lang="ts">
import { ref } from 'vue'

import GraphEditor from '@/components/GraphEditor.vue'
import { useSuggestionDbStore } from '@/stores/suggestionDatabase'
import { Toaster } from 'enso-dashboard'
import { createReactWrapper } from 'vue-react-wrapper'
import MockProjectStoreWrapper from '../mock/MockProjectStoreWrapper.vue'
import HstCode from './histoire/HstCode.vue'

const text = ref(`\
from Standard.Base import all
from Standard.Base.Runtime.Ref import Ref

from Standard.Test import Bench

options = Bench.options . set_warmup (Bench.phase_conf 1 2) . set_measure (Bench.phase_conf 3 2)

collect_benches = Bench.build builder->
    range_size = 100000000
    data = 0.up_to range_size

    builder.group "Range" options group_builder->
        group_builder.specify "iterate" <|
            cell = Ref.new 0
            data . each _->
                x = cell.get
                cell.put x+1

            cell.get . should_equal range_size

main =
    benches = collect_benches
    result = run_main benches
    third_node = 2 + 2
`)

const WrappedToastContainer = createReactWrapper(Toaster)
</script>

<template>
  <Story
    title="Editor"
    group="graph"
    :layout="{ type: 'single', iframe: false }"
    :setupApp="
      () => {
        useSuggestionDbStore()
      }
    "
    responsiveDisabled
    autoPropsDisabled
  >
    <WrappedToastContainer />t
    <MockProjectStoreWrapper v-model="text">
      <Suspense><GraphEditor /></Suspense>
    </MockProjectStoreWrapper>

    <template #controls><HstCode v-model="text" title="code" /></template>
  </Story>
</template>
